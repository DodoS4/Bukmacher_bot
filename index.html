<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kula Śnieżna - Dashboard Dawida</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: #f8fafc; }
        .glass-card { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .league-card { border-top: 4px solid #3b82f6; transition: transform 0.2s; }
        .league-card:hover { transform: translateY(-2px); }
        .gradient-text { background: linear-gradient(135deg, #60a5fa 0%, #2563eb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6">
            <div>
                <h1 class="text-4xl font-extrabold tracking-tight text-white mb-1">
                    CHALLENGE <span class="gradient-text">KULA ŚNIEŻNA</span>
                </h1>
                <p class="text-slate-400 font-medium">Automatyczny system wysokich stawek (5% bankrolla)</p>
            </div>
            <div class="glass-card px-6 py-3 rounded-2xl text-right">
                <span class="text-[10px] uppercase tracking-[0.2em] text-slate-500 font-bold">Ostatni Update API</span>
                <p id="last-update" class="text-blue-400 font-mono text-sm">Ładowanie danych...</p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <div class="glass-card p-6 rounded-3xl">
                <p class="text-slate-500 text-xs font-bold uppercase mb-2">Aktualny Portfel</p>
                <p id="balance" class="text-3xl font-black text-white">0.00 PLN</p>
            </div>
            <div class="glass-card p-6 rounded-3xl border-l-4 border-orange-500">
                <p class="text-slate-500 text-xs font-bold uppercase mb-2">Mecze w grze</p>
                <p id="upcoming-count" class="text-3xl font-black text-white text-orange-400">0</p>
            </div>
            <div class="glass-card p-6 rounded-3xl">
                <p class="text-slate-500 text-xs font-bold uppercase mb-2">Zysk Netto</p>
                <p id="total-profit" class="text-3xl font-black text-green-400">0.00 PLN</p>
            </div>
            <div class="glass-card p-6 rounded-3xl">
                <p class="text-slate-500 text-xs font-bold uppercase mb-2">Skuteczność ROI</p>
                <p id="roi" class="text-3xl font-black text-blue-400">0.0%</p>
            </div>
        </div>

        <div class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-layer-group text-blue-500"></i> Aktywne Grupy 
                    <span class="text-xs font-normal text-slate-500 bg-slate-800 px-3 py-1 rounded-full">Posortowane wg zysku</span>
                </h2>
            </div>
            
            <div id="groups-container" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                <div class="col-span-full py-20 text-center text-slate-600">
                    <i class="fas fa-circle-notch fa-spin fa-2xl mb-4 text-blue-500"></i>
                    <p>Pobieranie listy 80 meczów...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function loadDashboard() {
            try {
                // Anti-cache timestamp
                const response = await fetch('stats.json?nocache=' + new Date().getTime());
                const data = await response.json();

                // 1. Główne statystyki
                document.getElementById('balance').innerText = data.balance.toFixed(2) + ' PLN';
                document.getElementById('upcoming-count').innerText = data.upcoming_count;
                document.getElementById('total-profit').innerText = (data.total_profit >= 0 ? '+' : '') + data.total_profit.toFixed(2) + ' PLN';
                document.getElementById('roi').innerText = data.roi;
                document.getElementById('last-update').innerText = data.last_update;

                // 2. Budowanie grup meczów
                const container = document.getElementById('groups-container');
                container.innerHTML = '';

                if (data.groups && Object.keys(data.groups).length > 0) {
                    for (const [league, info] of Object.entries(data.groups)) {
                        let matchesHtml = '';
                        
                        info.matches.forEach(m => {
                            matchesHtml += `
                                <div class="flex justify-between items-center py-3 border-b border-slate-800/50 last:border-0">
                                    <div class="flex flex-col max-w-[70%]">
                                        <span class="text-sm font-semibold text-slate-200 truncate">${m.teams}</span>
                                        <span class="text-[10px] text-slate-500 uppercase font-bold">Typ: ${m.outcome} @ ${m.odds.toFixed(2)}</span>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-xs font-bold text-white">${m.stake.toFixed(2)} PLN</p>
                                        <p class="text-[10px] text-green-400 font-bold">+${m.profit.toFixed(2)}</p>
                                    </div>
                                </div>
                            `;
                        });

                        container.innerHTML += `
                            <div class="glass-card p-6 rounded-3xl league-card">
                                <div class="flex justify-between items-center mb-4 border-b border-slate-800 pb-3">
                                    <div>
                                        <h3 class="text-xs font-black text-blue-400 uppercase tracking-tighter">${league}</h3>
                                        <p class="text-[10px] text-slate-500">${info.matches.length} meczów</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-[10px] text-slate-500 uppercase font-bold">Potencjał</p>
                                        <p class="text-sm font-black text-green-400">+${info.total_potential_profit.toFixed(2)} PLN</p>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    ${matchesHtml}
                                </div>
                            </div>
                        `;
                    }
                } else {
                    container.innerHTML = '<div class="col-span-full text-center p-12 glass-card rounded-3xl text-slate-500">Brak aktywnych kuponów w tej chwili.</div>';
                }

            } catch (error) {
                console.error('Błąd:', error);
            }
        }

        // Odświeżaj co 60 sekund
        loadDashboard();
        setInterval(loadDashboard, 60000);
    </script>
</body>
</html>
