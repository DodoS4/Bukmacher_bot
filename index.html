<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Inwestycyjny - Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: sans-serif; }
        .card { background-color: #1e293b; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <header class="mb-8 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-blue-400">üìà BOT DASHBOARD</h1>
            <div id="last-update" class="text-slate-400 text-sm"></div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card border-l-4 border-green-500">
                <p class="text-slate-400 text-sm">ZYSK CA≈ÅKOWITY</p>
                <h2 id="total-profit" class="text-4xl font-bold text-green-400">≈Åadowanie...</h2>
            </div>
            <div class="card border-l-4 border-blue-500">
                <p class="text-slate-400 text-sm">SKUTECZNO≈öƒÜ</p>
                <h2 id="win-rate" class="text-4xl font-bold text-blue-400">--%</h2>
            </div>
            <div class="card border-l-4 border-purple-500">
                <p class="text-slate-400 text-sm">BANKROLL</p>
                <h2 id="bankroll" class="text-4xl font-bold text-purple-400">-- PLN</h2>
            </div>
        </div>

        <div class="card mb-8">
            <h3 class="text-xl font-bold mb-4">Krzywa wzrostu kapita≈Çu</h3>
            <canvas id="profitChart" height="100"></canvas>
        </div>

        <div class="card">
            <h3 class="text-xl font-bold mb-4">Ostatnie operacje</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="text-slate-400 border-b border-slate-700">
                        <tr>
                            <th class="py-2">Mecz</th>
                            <th class="py-2 text-center">Wynik</th>
                            <th class="py-2 text-right">Profit</th>
                        </tr>
                    </thead>
                    <tbody id="history-table"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                // Pobieranie danych (u≈ºywamy cache-busting, ≈ºeby dane by≈Çy ≈õwie≈ºe)
                const histRes = await fetch('history.json?v=' + Date.now());
                const history = await histRes.json();
                
                const brRes = await fetch('bankroll.json?v=' + Date.now());
                const brData = await brRes.json();

                // Obliczenia
                let cumulativeProfit = 0;
                const chartLabels = [];
                const chartData = [];
                let winCount = 0;

                const tableBody = document.getElementById('history-table');
                
                history.forEach((m, index) => {
                    cumulativeProfit += m.profit;
                    chartLabels.push(index + 1);
                    chartData.push(cumulativeProfit.toFixed(2));
                    if(m.profit > 0) winCount++;

                    // Dodawanie do tabeli (ostatnie 5)
                    if (index >= history.length - 10) {
                        const row = `
                            <tr class="border-b border-slate-800">
                                <td class="py-3 text-sm">${m.home} vs ${m.away}</td>
                                <td class="py-3 text-center text-xs font-mono">${m.score || '-:-'}</td>
                                <td class="py-3 text-right ${m.profit >= 0 ? 'text-green-400' : 'text-red-400'} font-bold">
                                    ${m.profit >= 0 ? '+' : ''}${m.profit.toFixed(2)}
                                </td>
                            </tr>
                        `;
                        tableBody.insertAdjacentHTML('afterbegin', row);
                    }
                });

                // Aktualizacja UI
                document.getElementById('total-profit').innerText = cumulativeProfit.toFixed(2) + ' PLN';
                document.getElementById('win-rate').innerText = ((winCount / history.length) * 100).toFixed(1) + '%';
                document.getElementById('bankroll').innerText = brData.bankroll.toFixed(2) + ' PLN';
                document.getElementById('last-update').innerText = 'Ostatnia analiza: ' + new Date().toLocaleString();

                // Wykres
                new Chart(document.getElementById('profitChart'), {
                    type: 'line',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            label: 'Zysk skumulowany',
                            data: chartData,
                            borderColor: '#60a5fa',
                            backgroundColor: 'rgba(96, 165, 250, 0.1)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: { responsive: true, scales: { y: { grid: { color: '#334155' } }, x: { display: false } } }
                });

            } catch (e) { console.error("B≈ÇƒÖd ≈Çadowania danych:", e); }
        }
        loadData();
    </script>
</body>
</html>
