<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>AI Betting PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { background:#f8fafc; font-family: Inter, system-ui; }
.card { background:white; border-radius:1.25rem; padding:1rem; border:1px solid #e5e7eb; }
.league-card:hover { transform: translateY(-2px); }
</style>
</head>

<body class="p-4 md:p-8">

<div class="max-w-7xl mx-auto space-y-8">

<!-- =================== HEADER =================== -->
<div class="flex justify-between items-center card">
  <div>
    <h1 class="text-2xl font-black uppercase italic">AI BETTING <span class="text-blue-600">PRO</span></h1>
    <p id="sync" class="text-xs text-slate-400 font-bold">Sync: --</p>
  </div>
  <div class="text-xs font-black bg-blue-600 text-white px-4 py-2 rounded-xl">LIVE</div>
</div>

<!-- =================== GLOBAL STATS =================== -->
<div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
  <div class="card"><p class="text-xs text-slate-400 font-bold">Bankroll</p><p id="bankroll" class="text-xl font-black"></p></div>
  <div class="card"><p class="text-xs text-slate-400 font-bold">Zysk Total</p><p id="profit-total" class="text-xl font-black text-blue-600"></p></div>
  <div class="card"><p class="text-xs text-slate-400 font-bold">Zysk 24h</p><p id="profit-24h" class="text-xl font-black"></p></div>
  <div class="card"><p class="text-xs text-slate-400 font-bold">Yield</p><p id="yield" class="text-xl font-black"></p></div>
  <div class="card"><p class="text-xs text-slate-400 font-bold">W grze</p><p id="active" class="text-xl font-black"></p></div>
  <div class="card"><p class="text-xs text-slate-400 font-bold">Kupony</p><p id="total" class="text-xl font-black"></p></div>
</div>

<!-- =================== CHART =================== -->
<div class="card">
  <h3 class="text-xs font-black text-slate-400 mb-2 uppercase">ğŸ“ˆ Progresja Bankrolla</h3>
  <div class="h-64"><canvas id="chart"></canvas></div>
</div>

<!-- =================== LEAGUE TILES =================== -->
<div>
  <h3 class="font-black mb-4">ğŸ† Ligi</h3>
  <div id="leagues" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
</div>

<!-- =================== DRILL DOWN =================== -->
<div id="league-details" class="card hidden">
  <div class="flex justify-between items-center mb-4">
    <h3 id="league-title" class="font-black text-lg"></h3>
    <button onclick="closeLeague()" class="text-xs font-bold text-red-500">Zamknij âœ–</button>
  </div>
  <div id="league-summary" class="mb-4 text-sm font-bold"></div>
  <div id="league-matches" class="space-y-3"></div>
</div>

</div>

<script>
const LEAGUE_NAMES = {
  "soccer_poland_ekstraklasa": "ğŸ‡µğŸ‡± Ekstraklasa",
  "soccer_germany_bundesliga": "ğŸ‡©ğŸ‡ª Bundesliga",
  "soccer_spain_la_liga": "ğŸ‡ªğŸ‡¸ La Liga",
  "soccer_italy_serie_a": "ğŸ‡®ğŸ‡¹ Serie A",
  "soccer_epl": "ğŸ´ Premier League",
  "icehockey_nhl": "ğŸ’ NHL",
  "basketball_euroleague": "ğŸ€ Euroliga"
};

let history = [];
let chart;

async function loadData() {
  const t = '?t=' + Date.now();
  const stats = await fetch('stats.json'+t).then(r=>r.json());
  history = await fetch('history.json'+t).then(r=>r.json());

  document.getElementById('bankroll').innerText = stats.bankroll.toFixed(2)+' PLN';
  document.getElementById('profit-total').innerText = stats.zysk_total.toFixed(2)+' PLN';
  document.getElementById('profit-24h').innerText = stats.zysk_24h.toFixed(2)+' PLN';
  document.getElementById('yield').innerText = stats.yield+'%';
  document.getElementById('active').innerText = stats.upcoming_val;
  document.getElementById('total').innerText = history.length;
  document.getElementById('sync').innerText = 'Sync: '+stats.last_sync;

  buildChart(stats.history_graph || []);
  buildLeagues();
}

function buildChart(data){
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById('chart'),{
    type:'line',
    data:{labels:data.map((_,i)=>i),
      datasets:[{data, borderWidth:3, borderColor:'#2563eb', fill:false, tension:0.3}]
    },
    options:{plugins:{legend:{display:false}}, scales:{x:{display:false}}}
  });
}

function buildLeagues(){
  const container = document.getElementById('leagues');
  container.innerHTML='';
  const grouped = {};

  history.forEach(m=>{
    grouped[m.sport] = grouped[m.sport] || [];
    grouped[m.sport].push(m);
  });

  Object.entries(grouped).forEach(([league, items])=>{
    const profit = items.reduce((a,b)=>a+b.profit,0);
    const wins = items.filter(i=>i.profit>0).length;

    container.innerHTML += `
      <div onclick="openLeague('${league}')" class="card league-card cursor-pointer transition">
        <p class="font-black">${LEAGUE_NAMES[league] || league}</p>
        <p class="text-sm ${profit>=0?'text-green-600':'text-red-600'} font-bold">${profit.toFixed(2)} PLN</p>
        <p class="text-xs text-slate-400">${wins}/${items.length} WIN</p>
      </div>`;
  });
}

function openLeague(league){
  const items = history.filter(h=>h.sport===league);
  const profit = items.reduce((a,b)=>a+b.profit,0);

  document.getElementById('league-title').innerText = LEAGUE_NAMES[league] || league;
  document.getElementById('league-summary').innerText =
    `Bilans: ${profit.toFixed(2)} PLN | Mecze: ${items.length}`;

  document.getElementById('league-matches').innerHTML = items
    .sort((a,b)=>new Date(b.time)-new Date(a.time))
    .map(m=>{
      const d = new Date(m.time);
      return `
      <div class="p-3 rounded-xl border ${m.profit>0?'bg-green-50 border-green-300':'bg-red-50 border-red-300'}">
        <div class="flex justify-between font-bold text-sm">
          <span>${m.home} â€“ ${m.away}</span>
          <span class="${m.profit>0?'text-green-600':'text-red-600'}">${m.profit.toFixed(2)} PLN</span>
        </div>
        <div class="text-xs text-slate-500 mt-1">
          ğŸ•’ ${d.toLocaleDateString()} ${d.toLocaleTimeString().slice(0,5)} |
          ğŸ¯ ${m.outcome} |
          ğŸ’° ${m.stake} PLN @${m.odds} |
          ğŸ ${m.score || ''}
        </div>
      </div>`;
    }).join('');

  document.getElementById('league-details').classList.remove('hidden');
}

function closeLeague(){
  document.getElementById('league-details').classList.add('hidden');
}

loadData();
</script>

</body>
</html>
