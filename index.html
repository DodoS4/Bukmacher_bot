        // ŁADOWANIE DANYCH
        async function loadData() {
            try {
                // Dodajemy timestamp, aby uniknąć cache'owania przez przeglądarkę
                const res = await fetch('history.json?v=' + Date.now());
                const history = await res.json();
                
                let totalProfit = 0, totalStaked = 0;
                const leagues = {}, chartLabels = [], chartData = [];

                // Reset ranking kontenera przed ładowaniem
                document.getElementById('league-ranking').innerHTML = '';
                document.getElementById('history-table').innerHTML = '';

                history.forEach((m, idx) => {
                    totalProfit += m.profit;
                    totalStaked += (m.stake || 250);
                    
                    // Czytelniejsza nazwa ligi (np. NHL, EKSTRAKLASA, LA LIGA)
                    let sport = m.sport.replace('soccer_', '').replace('icehockey_', '').replace(/_/g, ' ').toUpperCase();
                    leagues[sport] = (leagues[sport] || 0) + m.profit;
                    
                    chartLabels.push(idx + 1);
                    chartData.push(totalProfit.toFixed(2));
                });

                // Podstawowe statystyki
                document.getElementById('total-profit').innerText = totalProfit.toFixed(2) + ' PLN';
                document.getElementById('total-staked').innerText = totalStaked.toFixed(2) + ' PLN';
                document.getElementById('total-bets').innerText = history.length;
                
                const yieldVal = totalStaked > 0 ? ((totalProfit / totalStaked) * 100).toFixed(1) : 0;
                document.getElementById('yield-val').innerText = yieldVal + '%';
                
                // Progress Bar
                const prog = Math.max(0, Math.min(100, (totalProfit / 5000) * 100));
                document.getElementById('progress-bar').style.width = prog + '%';
                document.getElementById('progress-percent').innerText = prog.toFixed(1) + '%';
                document.getElementById('last-update').innerText = 'Sync: ' + new Date().toLocaleString();

                // Generowanie rankingu lig
                const ranking = document.getElementById('league-ranking');
                Object.entries(leagues).sort((a,b) => b[1] - a[1]).forEach(([name, val]) => {
                    ranking.innerHTML += `
                        <div class="flex justify-between items-center p-2 rounded bg-gray-50 dark:bg-slate-700/30 border-l-4 ${val >= 0 ? 'border-green-500' : 'border-red-500'}">
                            <span class="text-[10px] font-bold uppercase tracking-widest">${name}</span>
                            <span class="text-sm font-black ${val >= 0 ? 'text-green-500' : 'text-red-500'}">${val > 0 ? '+' : ''}${val.toFixed(2)}</span>
                        </div>`;
                });

                // Generowanie tabeli historii
                const table = document.getElementById('history-table');
                history.slice().reverse().forEach(m => {
                    const isWin = m.profit > 0;
                    const oddsColor = m.odds >= 3.0 ? 'text-yellow-500' : 'text-blue-500';
                    
                    table.innerHTML += `
                        <tr class="hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors border-b dark:border-slate-800">
                            <td class="px-6 py-4 text-[10px] text-gray-400 font-mono">${m.time ? m.time.split('T')[0] : '--'}</td>
                            <td class="px-6 py-4">
                                <div class="text-xs font-bold">${m.home} - ${m.away}</div>
                                <div class="text-[9px] text-gray-500 uppercase">${m.sport.split('_').pop()}</div>
                            </td>
                            <td class="px-6 py-4 text-xs italic">
                                ${m.outcome} <span class="${oddsColor} font-black">@${m.odds}</span>
                            </td>
                            <td class="px-6 py-4 text-xs font-mono font-bold">${m.score || '-- : --'}</td>
                            <td class="px-6 py-4 text-right font-black ${isWin ? 'text-green-500' : 'text-red-500'}">
                                ${isWin ? '+' : ''}${m.profit.toFixed(2)}
                            </td>
                        </tr>`;
                });

                // Wykres
                new Chart(document.getElementById('profitChart'), {
                    type: 'line',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            label: 'Zysk',
                            data: chartData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2,
                            pointBackgroundColor: '#3b82f6'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: { 
                            x: { display: false },
                            y: { 
                                grid: { color: 'rgba(156, 163, 175, 0.05)' },
                                ticks: { font: { size: 10 } }
                            }
                        }
                    }
                });

            } catch (e) { 
                console.error("Data error", e); 
                document.getElementById('league-ranking').innerHTML = '<p class="text-red-500">Błąd ładowania danych historycznych.</p>';
            }
        }
        loadData();
