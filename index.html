<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; color: #111827; }
        .stat-card { background: white; padding: 1rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .win { border-left: 4px solid #10b981; }
        .loss { border-left: 4px solid #ef4444; }
        .chart-container { height: 250px; width: 100%; }
    </style>
</head>
<body class="p-4">
    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-xl font-black uppercase italic">AI BETTING <span class="text-blue-600">PRO</span></h1>
            <span id="refresh-timer" class="text-xs font-bold bg-blue-600 text-white px-3 py-1 rounded">REF: 300s</span>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-6 text-center">
            <div class="stat-card">
                <p class="text-[10px] text-gray-400 uppercase font-bold">Zysk 24h</p>
                <p id="today-profit" class="text-lg font-black">0.00</p>
            </div>
            <div class="stat-card border-b-4 border-blue-600">
                <p class="text-[10px] text-blue-600 uppercase font-bold">Zysk Total</p>
                <p id="total-profit" class="text-lg font-black">0.00</p>
            </div>
            <div class="stat-card">
                <p class="text-[10px] text-purple-600 uppercase font-bold">ROI</p>
                <p id="roi-val" class="text-lg font-black">0%</p>
            </div>
            <div class="stat-card">
                <p class="text-[10px] text-gray-400 uppercase font-bold">Obrót</p>
                <p id="turnover-val" class="text-lg font-black">0</p>
            </div>
            <div class="stat-card">
                <p class="text-[10px] text-orange-500 uppercase font-bold">Yield</p>
                <p id="yield-val" class="text-lg font-black">0%</p>
            </div>
            <div class="stat-card">
                <p class="text-[10px] text-gray-400 uppercase font-bold">Kupony</p>
                <p id="total-bets-count" class="text-lg font-black">0</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
            <h3 class="text-xs font-black uppercase text-gray-400 mb-4 tracking-widest italic">Wykres Progresji</h3>
            <div class="chart-container">
                <canvas id="profitChart"></canvas>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
                <h3 class="text-xs font-black uppercase text-amber-500 mb-3">Oczekujące</h3>
                <div id="active-bets-container" class="space-y-2"></div>
            </div>
            <div>
                <h3 class="text-xs font-black uppercase text-green-500 mb-3">Ostatnie Wyniki</h3>
                <div id="recent-results-container" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <script>
        let profitChart = null;
        let countdown = 300;

        async function loadData() {
            try {
                const s = await (await fetch('stats.json?v=' + Date.now())).json();
                const coupons = await (await fetch('coupons.json?v=' + Date.now())).json();
                const history = await (await fetch('history.json?v=' + Date.now())).json();

                document.getElementById('total-profit').innerText = s.zysk_total.toFixed(2) + ' PLN';
                document.getElementById('today-profit').innerText = (s.zysk_24h >= 0 ? '+' : '') + s.zysk_24h.toFixed(2);
                document.getElementById('today-profit').className = `text-lg font-black ${s.zysk_24h >= 0 ? 'text-green-600' : 'text-red-600'}`;
                document.getElementById('roi-val').innerText = s.roi + '%';
                document.getElementById('turnover-val').innerText = s.obrot.toLocaleString();
                document.getElementById('yield-val').innerText = s.yield + '%';
                document.getElementById('total-bets-count').innerText = s.total_bets_count;

                // WYKRES - KLUCZ DO CZYTELNOŚCI
                if(profitChart) profitChart.destroy();
                profitChart = new Chart(document.getElementById('profitChart'), {
                    type: 'line',
                    data: {
                        labels: s.wykres.map((_, i) => i),
                        datasets: [{
                            data: s.wykres,
                            borderColor: '#2563eb',
                            borderWidth: 2,
                            pointRadius: 2, // Małe, czytelne kropki
                            pointBackgroundColor: '#2563eb',
                            fill: false,
                            tension: 0.1 // Prawie prosta linia (największa czytelność)
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { x: { display: false }, y: { grid: { color: '#f3f4f6' } } }
                    }
                });

                // AKTYWNE
                const activeCont = document.getElementById('active-bets-container');
                activeCont.innerHTML = coupons.length ? coupons.map(c => `
                    <div class="bg-white p-3 rounded-lg shadow-sm border-l-4 border-amber-400">
                        <p class="text-[10px] font-bold text-gray-400 uppercase">${c.sport.replace('soccer_', '').replace('icehockey_', '').replace(/_/g, ' ')}</p>
                        <p class="text-xs font-black">${c.home} - ${c.away}</p>
                        <p class="text-[10px] font-bold text-blue-600 uppercase">${c.outcome} @${c.odds}</p>
                    </div>
                `).join('') : '<p class="text-xs text-gray-400 italic">Brak typów</p>';

                // OSTATNIE
                const recentCont = document.getElementById('recent-results-container');
                const last10 = [...history].reverse().slice(0, 10);
                recentCont.innerHTML = last10.map(m => `
                    <div class="bg-white p-3 rounded-lg shadow-sm flex justify-between items-center ${m.profit > 0 ? 'win' : 'loss'}">
                        <div class="truncate">
                            <p class="text-[10px] font-bold text-gray-400">${m.home.substring(0,12)} - ${m.away.substring(0,12)}</p>
                            <p class="text-xs font-black text-gray-700">@${m.odds}</p>
                        </div>
                        <p class="text-sm font-black ${m.profit > 0 ? 'text-green-600' : 'text-red-600'}">${m.profit > 0 ? '+' : ''}${m.profit.toFixed(2)}</p>
                    </div>
                `).join('');

            } catch (e) { console.error(e); }
        }

        setInterval(() => { countdown--; document.getElementById('refresh-timer').innerText = `REF: ${countdown}s`; if(countdown<=0){ loadData(); countdown=300; } }, 1000);
        loadData();
    </script>
</body>
</html>
