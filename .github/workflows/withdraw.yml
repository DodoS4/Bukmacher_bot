name: Wyp≈Çata pieniƒôdzy üí∏

on:
  workflow_dispatch:
    inputs:
      amount:
        description: 'Kwota do wyp≈Çaty (np. 500)'
        required: true
        default: '0'

jobs:
  withdraw:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Run Withdrawal
        env:
          T_TOKEN: ${{ secrets.T_TOKEN }}
          T_CHAT: ${{ secrets.T_CHAT }}
        run: |
          python - <<EOF
          import withdraw

          try:
              amount = float("${{ github.event.inputs.amount }}")
          except ValueError:
              print("‚ùå B≈Çƒôdna kwota")
              exit(0)

          if amount > 0:
              withdraw.add_withdraw(amount)
          else:
              print("‚ö†Ô∏è Kwota 0 ‚Äì brak wyp≈Çaty")
          EOF

      - name: Commit and Push
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"

          if git diff --quiet history.json; then
            echo "‚ÑπÔ∏è Brak zmian w history.json ‚Äì pomijam commit"
          else
            git add history.json
            git commit -m "üí∏ Wyp≈Çata: ${{ github.event.inputs.amount }} PLN"
            git push
          fi
